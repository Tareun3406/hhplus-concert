## 캐시 적용하기

### 캐시 읽기 전략
#### Look Aside 패턴
- 데이터 조회시 캐시에 저장된 데이터가 있는지 먼저 확인, 캐시에 데이터가 없으면 DB 에서 조회 후 캐시에 저장
- Look Aside 패턴의 단독 사용시 데이터 변경사항이 바로 반영되지 않음.

> 캐시 스템피드 현상이란
> 캐시가 저장되지 않은 데이터에 대해 동시에 여러 요청이 들어올 경우 각각의 요청이 모두 캐시 데이터를 찾지 못하고 DB 데이터를 조회하게됨
> 특히 TTL 을 통해 캐시 데이터가 만료된 순간 다수의 요청이 모두 DB 조회 및 캐시 쓰기 요청을 발생시킬 수 있으니 주의해야 한다.

#### Read Through 패턴
- 캐시 데이터의 동기화를 별도로 진행
- 서버에서는 캐시 데이터만 조회

### 캐시 쓰기 전략
#### Write Back 패턴 (Write Behind 패턴)
- 데이터를 저장시 캐시에 저장해두고 일정 주기로 DB 반영

#### Write Through 패턴
- 데이터 저장시 캐시와 DB 모두에 저장
- 데이터의 정합성 유지

> 다른 읽기 전략과 함께 사용하면 캐시를 통한 읽기의 장점을 챙기면서 데이터의 정합성을 유지시켜 줄 수 있다.

Write Around 패턴
- 데이터를 모두 DB에 저장.
- 다른 읽기 전략과의 조합을 통해 캐시를 이용.


## 콘서트 API 에 캐시 적용하기 (feat. 콘서트 순위 API)

### 캐시를 적용하기 좋은 조건
- 반복적으로 조회되는 데이터
- 변경이 적은 데이터

### 현재 예약 많이 발생하고 있는 콘서트 순위 API
- 콘서트 일정이 속해있는 콘서트의 데이터는 메타성 데이터로 변경이 발생하지 않음. ( 공연자, 콘서트 이름 )
- 같은 데이터를 반복해서 조회.

### 구현 방법 (Redis 사용)
- Redis의 SortedSet 자료구조를 활용. Score 값 = 예약 횟수
- 데이터의 수집 주기는 기본 10분으로 설정.
- 일정 예약시 해당 콘서트의 도메인 객체를 요소로 하여 저장 및 Score 증가.
- 각 수집 주기마다 별도의 키 사용. ( 02:10 ~ 02:19 까지 같은 Key, 02:20 ~ 02:29 까지 같은 키 사용.)
- 각 키에는 만료시간을 적용하여 캐시데이터가 너무 많아지는 것을 방지. (60 분)

![img.png](/docs/img/cache.png)