# MSA로의 전환에 따른 트랜잭션 처리의 한계와 해결방안

## 1. 개요

서비스의 규모가 확장됨에 따라 기존의 모놀리식 아키텍처에서 MSA(Microservices Architecture)로 전환이 필요하다. 

각 도메인을 독립적인 마이크로서비스로 분리하면서 트랜잭션 관리의 어려움이 발생할 수 있다. 본 문서에서는 MSA 환경에서의 트랜잭션 처리 한계와 해결방안을 다룬다.

## 2. 트랜잭션 처리의 한계

### 2.1. 분산 트랜잭션의 어려움

- 마이크로서비스 간 분리된 데이터베이스를 사용함에 따라 기존 단일 트랜잭션을 보장하는 ACID 원칙 적용이 어려움.

- 트랜잭션이 여러 마이크로서비스를 거칠 경우 일관성(consistency) 유지가 어렵다.

### 2.2. 네트워크 지연과 장애 발생 가능성

- 마이크로서비스 간 통신이 네트워크를 통해 이루어지므로, 장애 발생 시 트랜잭션 처리가 실패할 가능성이 높음.

- 트랜잭션 지연으로 인해 성능 저하 및 사용자 경험 저하 발생 가능.

### 2.3. 데이터 정합성 보장 문제

- 여러 서비스가 동일한 데이터를 갱신할 때 정합성 문제 발생 가능.

- 서로 다른 데이터 저장소에서 중복된 데이터를 관리할 경우 동기화 이슈 발생.

## 3. 해결방안

### 3.1. 보상 트랜잭션(Compensating Transaction)

- 각 서비스에서 트랜잭션을 독립적으로 실행하고, 실패 시 이전 트랜잭션을 취소하는 보상 트랜잭션을 실행한다.

- 예시: 결제 성공 후 주문 생성 실패 시 결제를 자동 취소.



### 3.2. 이벤트 기반 아키텍처 도입

- 마이크로서비스 간 강한 결합도를 낮추고, 이벤트 중심의 비동기 통신을 통해 데이터 정합성을 유지.

- 이벤트 소싱(Event Sourcing) 패턴을 적용하여 변경 이력을 관리하고, 장애 발생 시 롤백 가능하도록 함.



### 3.3. SAGA 패턴 활용

SAGA 패턴은 분산 트랜잭션을 관리하는 대표적인 기법이며, 보상 트랜잭션(Compensating Transaction)을 활용하여 데이터 정합성을 유지하는 방식이다.

SAGA 패턴은 MSA 환경에서 분산 트랜잭션을 관리하는 대표적인 패턴이다. SAGA는 다음 두 가지 방식으로 구현될 수 있다.

### 3.3.1. 코레오그래피 방식(Choreography-based Saga)

- 이벤트 기반으로 각 서비스가 자체적으로 트랜잭션을 관리하는 방식.

- 서비스 간 직접적인 호출 없이 메시지 브로커(Kafka, RabbitMQ 등)를 활용하여 트랜잭션을 연결.

- 이벤트 기반으로 각 서비스가 자체적으로 트랜잭션을 관리하는 방식.

- 서비스 간 직접적인 호출 없이 메시지 브로커(Kafka, RabbitMQ 등)를 활용하여 트랜잭션을 연결.

- 실패 시 보상 트랜잭션 실행을 위해 별도의 실패 이벤트를 발생시켜야 하며, 이를 처리할 보상 서비스가 필요하다.

### 3.3.2. 오케스트레이션 방식(Orchestration-based Saga)

- 중앙 조정 서비스(오케스트레이터)가 트랜잭션을 관리하며, 각 마이크로서비스에 필요한 작업을 순차적으로 실행하고 실패 시 보상 트랜잭션을 호출.

- 서비스 간 직접적인 이벤트 전달이 아니라 중앙 컨트롤러에서 트랜잭션을 조정하는 방식.

- 예시: 주문 서비스가 중앙 오케스트레이터 역할을 하며, 결제, 배송 등의 서비스 트랜잭션을 조정함.